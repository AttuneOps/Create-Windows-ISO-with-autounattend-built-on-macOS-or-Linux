
<!doctype html>
<html lang="en">




<head>
    <title>How to WinPE Essentials Extraction on Windows - Attune Automation</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="title"
          content="How to WinPE Essentials Extraction on Windows - Attune Automation">
    <meta name="description"
          content="Sets up the "plain" WinPE skeleton files on Windows Worker at `C:\WinPE_amd64`.

This folder can be copied and then it's `.\media\sources\boot.wim` file can be modified for an automated unattended Windows install.

This folder works for both BIOS and UEFI boot methods.">
    <meta name="robots"
          content="follow, index, max-snippet:-1, max-video-preview:-1, max-image-preview:large">

    <meta property="og:locale" content="en_AU" />
    <meta property="og:type" content="article" />
    <meta property="og:title"
          content="HowTo WinPE Essentials Extraction on Windows - Attune Automation" />
    <meta property="og:description" content="Sets up the "plain" WinPE skeleton files on Windows Worker at `C:\WinPE_amd64`.

This folder can be copied and then it's `.\media\sources\boot.wim` file can be modified for an automated unattended Windows install.

This folder works for both BIOS and UEFI boot methods." />
    <meta property="og:site_name" content="Attune Automation" />
    <meta property="article:section" content="IT Instruction" />

    <meta name="twitter:title"
          content="How to WinPE Essentials Extraction on Windows - Attune Automation" />
    <meta name="twitter:description" content="Sets up the "plain" WinPE skeleton files on Windows Worker at `C:\WinPE_amd64`.

This folder can be copied and then it's `.\media\sources\boot.wim` file can be modified for an automated unattended Windows install.

This folder works for both BIOS and UEFI boot methods." />

    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-32x32.png" sizes="32x32">
    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-192x192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-180x180.png">
    <meta name="msapplication-TileImage" content="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-270x270.png">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="styles/style.css">

    <!-- Google tag (gtag.js) -->
    <script async
            src="https://www.googletagmanager.com/gtag/js?id=G-5TZQZNDJCD"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-5TZQZNDJCD');
    </script>
</head>


<body>

<!-- Project NavBar -->

<div class="bg-white border-bottom box-shadow sticky-top mb-3">
<div class="container px-0">
    <div class="row px-0">
        <div class="col d-flex flex-column flex-lg-row align-items-center px-0
            py-3">
            <a class="navbar-brand my-0 mr-lg-auto"
                  href="https://www.servertribe.com/"
                  target="_blank">
                    <img
                        src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                        alt="Attune - Powered by ServerTribe"
                        class="img-fluid navbar-img">
            </a>
            <nav class="my-2 my-lg-0 mr-lg-3">
                <a class="p-2 text-dark" href="http://doc.servertribe.com/"
                   target="_blank">
                    Documentation
                </a>
                <a class="p-2 text-dark"
                   href="https://discord.com/invite/3YpJsagqUn"
                   target="_blank">
                    Discord
                </a>
                <a class="p-2 text-dark" href="https://github.com/Attune-Automation"
                   target="_blank">
                    GitHub
                </a>
                <a class="p-2 text-dark" href="https://www.servertribe.com/learn/"
                   target="_blank">
                    Learn
                </a>
            </nav>
            <a class="btn btn-outline-primary"
               href="https://www.servertribe.com/download-attune-registration/"
               target="_blank">
                Download NOW!
            </a>
        </div>
    </div>
</div></div>

<!-- Project breadcrumbs -->

<!-- Project breadcrumbs -->
<div class="container px-0">
    <div class="row">
        <nav class="col px-0" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="index.html">
                    Automate Windows Installation with autounattend
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    <strong>WinPE Essentials Extraction on Windows</strong>
                </li>
            </ol>
        </nav>
    </div>
</div>

<!-- Blueprint Header -->

<div class="container px-0">
    <!-- Blueprint name and description -->
    <div class="row">
        <div class="col px-0">
            <h1 class="text-left">
                How to WinPE Essentials Extraction on Windows
            </h1>
        </div>
    </div>

<!-- Blueprint Description -->
    <div class="row">
        <div class="description col px-0">
            <p class="text-left">
                <p>Sets up the "plain" WinPE skeleton files on Windows Worker at <code>C:\WinPE_amd64</code>.</p>
<p>This folder can be copied and then it's <code>.\media\sources\boot.wim</code> file can be modified for an automated unattended Windows install.</p>
<p>This folder works for both BIOS and UEFI boot methods.</p>
            </p>
        </div>
    </div>
    <div class="row pt-4">
        <div class="col-6 px-0">
            <h6 class="text-left">
                This documentation is generated by
                <a href="https://www.servertribe.com/"
                    class="badge badge-primary"
                    target="_blank">
                    Attune
                </a>
            </h6>
        </div>
        <div class="col-6 align-self-end text-right px-0">
            <h6 class="text-right">
                <a href="https://www.youtube.com/@servertribe"
                    class="badge badge-secondary"
                    target="_blank">
                    YouTube
                </a>
                <a href="https://github.com/Attune-Automation"
                    class="badge badge-secondary"
                    target="_blank">
                    GitHub
                </a>
                <a href="https://discord.com/invite/3YpJsagqUn"
                    class="badge badge-secondary"
                    target="_blank">
                    Discord
                </a>
                <a href="https://www.linkedin.com/company/servertribe/"
                    class="badge badge-secondary"
                    target="_blank">
                    LinkedIn
                </a>
                <a href="http://doc.servertribe.com/"
                    class="badge badge-secondary"
                    target="_blank">
                    Documentation
                </a>
            </h6>
        </div>
    </div>
    <hr>
</div>

<div class="documentation">
    <div class="container px-0">
        <div class="row">

<!-- Blueprint ToC -->


            <div class="toc col-lg-2 px-0 pr-5">
                <div class="container px-0 pt-3">
                    <p class="pb-2">
                        <strong>Contents</strong>
                    </p>
                    <p class="text-muted">
                        <a href="#top">
                            <strong>WinPE Essentials Extraction on Windows</strong>
                        </a>
                    </p>


    
        

                    <p class="text-muted pt-2">
                        <a href="#deploywin2019dvdisotobuildwinpeisoonwindowsworker">
                            <strong>Step 1 -</strong> Deploy Win2019 DVD ISO to build-winpe-iso on Windows Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#extractwinserverdvdisotowinimgonwindowsworker">
                            <strong>Step 2 -</strong> Extract Win Server DVD ISO to winimg on Windows Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#deleteskeletonwinpeamd64folderonwindowsworker">
                            <strong>Step 3 -</strong> Delete Skeleton WinPE_amd64 Folder on Windows Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#createskeletonwinpefilesonwindowsworker">
                            <strong>Step 4 -</strong> Create Skeleton WinPE Files on Windows Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#overwritefwfilesefisysbinwithefisysnopromptbininskeletonwinpeamd64folderonwindowsworker">
                            <strong>Step 5 -</strong> Overwrite fwfiles\efisys.bin with efisys_noprompt.bin in Skeleton WinPE_amd64 Folder on Windows Worker
                        </a>
                    </p>


                </div>
            </div>

<!-- Blueprint Contents -->
            <div class="col-lg-8 pt-3">
                <div class="container">


        <div class="jumbotron">
            <p class="display-3 text-center">
                <strong>Automate This</strong>
            </p>
            <p class="lead text-center">
                Use the <strong>Attune GUI</strong> for your Scripts
            </p>
            <p class="lead">
                <ol>
                    <a href="https://www.servertribe.com/download-attune-registration/"
                        target="_blank">
                        <span class="badge badge-primary">1</span>
                        Download Attune
                        <i class="fa-solid fa-download fa-beat-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://github.com/attune-Automation/"
                        target="_blank">
                        <span class="badge badge-primary">2</span>
                         Copy the Attune Project URL
                         <i class="fa-brands fa-github fa-fade"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://servertribe-attune.readthedocs.io/en/latest/howto/design_workspace/clone_project.html"
                        target="_blank">
                        <span class="badge badge-primary">3</span>
                        Clone the Project in Attune
                         <i class="fa-solid fa-book fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://www.youtube.com/watch?v=GCWDI29rDV0"
                        target="_blank">
                        <span class="badge badge-primary">4</span>
                        Plan your Job(s)
                        <i class="fa-brands fa-youtube fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://www.youtube.com/watch?v=b7DhFcURkZg"
                        target="_blank">
                        <span class="badge badge-primary">5</span>
                        Run your Job(s)
                        <i class="fa-brands fa-youtube fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
            </p>
            <p class="lead text-center">
                You've automated: <strong>WinPE Essentials Extraction on Windows</strong>
            </p>
            <hr class="my-4 text-center">
            <div class="col px-0">
                <p class="text-center">
                    Get the most out of automation with our get started
                    videos, product demonstrations, and more.
                </p>
                <p class="lead text-center">
                    <a class="btn btn-primary btn-lg"
                       href="https://www.servertribe.com/learn/"
                       target="_blank"
                       role="button">
                        Learn Attune Automation
                    </a>
                </p>
            </div>
        </div>

        <div class="row">
            <p>The following steps will guide you through the manual process.</p>
        </div>

<!-- Blueprint Steps -->


        



                    <div class="row pt-5">
                        <h3 id="deploywin2019dvdisotobuildwinpeisoonwindowsworker">
                            <a href="#deploywin2019dvdisotobuildwinpeisoonwindowsworker">
                                <strong>Step 1 -</strong> Deploy Win2019 DVD ISO to build-winpe-iso on Windows Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deploys the Win2019 DVD ISO to the <code>C:\attuneautomationworker\build-winpe-iso</code> directory on Windows Worker.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via RDP:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
mstsc /admin /v:{automationworkerwindowsnode}
                            </code>
                        </div>
                        <div class="row">
                            <p>
                                Login as user {automationworkerwindowsuseradministrator} and open a
                                command prompt.
                            </p>
                        </div>


    



    <div class="row">
        <p>
            <p>Download from https://www.microsoft.com/en-us/evalcenter/download-windows-server-2019.</p>
        </p>
        <p>
            Copy the File(s)
            <strong>Win201_ISO.tar</strong>
            to the target node.
        </p>
        <p>
            <strong>Deploy the File(s)</strong> here:
        </p>
    </div>
    <div class="row py-1">
        <code class="language-bash">
{automationWorkerWindowsBaseDirectorySharePath}/build-winpe-iso, relative to the home directory
        </code>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="extractwinserverdvdisotowinimgonwindowsworker">
                            <a href="#extractwinserverdvdisotowinimgonwindowsworker">
                                <strong>Step 2 -</strong> Extract Win Server DVD ISO to winimg on Windows Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Extracts the Windows Server ISO using <code>7z.exe</code> to <code>C:\attuneautomationworker\build-winpe-iso\winimg</code>.</p>
<p><code>winimg</code> stands for Windows Image.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$ISO_BUILD=&quot;{automationWorkerWindowsBaseDirectory}&quot;
$BUILD_DIR=&quot;${ISO_BUILD}\build-winpe-iso&quot;

Set-Location $BUILD_DIR

$ISO_WILDCARD=&quot;*.iso&quot;
$FOLDER=&quot;winimg&quot;

if (test-Path &quot;${ISO_WILDCARD}&quot; -pathtype leaf) {
    $ISO=(dir $ISO_WILDCARD).name
    Write-Host &quot;Found ISO ${ISO}. Extracting it.&quot;
    
    &amp; &#x27;C:\Program Files\7-Zip\7z.exe&#x27; x &quot;.\${ISO}&quot; -o&quot;${FOLDER}&quot;
    
    Write-Host &quot;Removing ${ISO}&quot;
    Remove-Item &quot;${ISO}&quot;

} else {
	Write-Error &quot;No ISO found for extracting.&quot;
}
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="deleteskeletonwinpeamd64folderonwindowsworker">
                            <a href="#deleteskeletonwinpeamd64folderonwindowsworker">
                                <strong>Step 3 -</strong> Delete Skeleton WinPE_amd64 Folder on Windows Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes Skeleton <code>C:\WinPE_amd64</code> folder on Windows Worker.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$WinPE_amd64=&quot;{automationWorkerWindowsBaseDirectory}\WinPE_amd64&quot;

Write-Host &quot;Checking if the path $WinPE_amd64 exists...&quot;

if (Test-Path &quot;${WinPE_amd64}&quot;) {

    Write-Host &quot;Path found. Removing the directory $WinPE_amd64 and its contents...&quot;
    Remove-Item -Path &quot;${WinPE_amd64}&quot; -Recurse
    Write-Host &quot;Directory $WinPE_amd64 has been removed successfully.&quot;

    
} else {

    Write-Host &quot;Path $WinPE_amd64 does not exist. No action required.&quot;

    
}
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="createskeletonwinpefilesonwindowsworker">
                            <a href="#createskeletonwinpefilesonwindowsworker">
                                <strong>Step 4 -</strong> Create Skeleton WinPE Files on Windows Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Starts the <code>Deployment and Imaging Tools Environment</code>.
Creates the skeleton WinPE files at <code>C:\WinPE_amd64</code>.</p>
<p>The path to <code>DandISetEnv.bat</code> was found by:
1. Typing in "Deployment and Imaging Tools Environment" in the Windows search box.
2. Right click on <strong>Deployment and Imaging Tools Environment</strong>.
3. Click on <strong>Open file location</strong>.
4. Right click on the file <strong>Deployment and Imaging Tools Environment</strong>.
5. Click <strong>Properties</strong>.
6. Look at the path in the <strong>Target</strong> field.</p>
<p>Use <code>call</code> to run multiple commands after running the batch file <code>DandISetEnv.bat</code>. Referenced from https://superuser.com/questions/1079403/how-to-run-multiple-commands-one-after-another-in-cmd.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
call &quot;C:\Program Files (x86)\Windows Kits\10\Assessment and Deployment Kit\Deployment Tools\DandISetEnv.bat&quot; dir
copype amd64 {automationWorkerWindowsBaseDirectory}\WinPE_amd64
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="overwritefwfilesefisysbinwithefisysnopromptbininskeletonwinpeamd64folderonwindowsworker">
                            <a href="#overwritefwfilesefisysbinwithefisysnopromptbininskeletonwinpeamd64folderonwindowsworker">
                                <strong>Step 5 -</strong> Overwrite fwfiles\efisys.bin with efisys_noprompt.bin in Skeleton WinPE_amd64 Folder on Windows Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Overwrites this default <code>efisys.bin</code> created by the  Windows Assessment and Deployment Kit:
* <code>C:\WinPE_amd64\fwfiles\efisys.bin</code> - which prompts the user to "Press any key To boot from CD or DVD . . . ." for UEFI boots methods.</p>
<p>with the <code>efisys_noprompt.bin</code> file from Win2019 DVD ISO:
* <code>C:\attuneautomationworker\build-winpe-iso\winimg\efi\microsoft\boot\efisys_noprompt.bin</code> - which does not have the "Press any key To boot from CD or DVD . . . ." prompt for UEFI boot methods.</p>
<p>After this step WinPE ISOs built with a copy of the skeleton WinPE directory <code>C:\WinPE_amd64</code> will not prompt for the "Press any key To boot from CD or DVD . . . ." for UEFI boots methods.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
$SKELETON_FWFILES_PATH=&quot;{automationWorkerWindowsBaseDirectory}\WinPE_amd64\fwfiles&quot;

Set-Location &quot;${SKELETON_FWFILES_PATH}&quot;

$WinPE_amd64_PATH=&quot;{automationWorkerWindowsBaseDirectory}\build-winpe-iso\WinPE_amd64&quot;

Write-Host &quot;Before hash of efisys.bin&quot;
Get-FileHash .\efisys.bin
    
Copy-Item `
    -Path &quot;{automationWorkerWindowsBaseDirectory}\build-winpe-iso\winimg\efi\microsoft\boot\efisys_noprompt.bin&quot; `
    -Destination &quot;.\efisys.bin&quot;
    
Write-Host &quot;After hash of efisys.bin&quot;
Get-FileHash .\efisys.bin
                </code>
            </pre>
        </div>
    </div>






                    <div class="row pt-5">
                        <div class="col">
                            <h2>Completed</h2>
                            <p>
                                You have completed this instruction.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

<!-- Download Attune Ad -->

            <div class="toc col-lg-2 px-0">
                <div class="container px-0 pt-3 pl-5">
                    <div class="card border-light mb-3" style="max-width: 18rem;">
                        <div class="card-body attune-ad">
                            <img
                                src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                                alt="Attune - Powered by ServerTribe"
                                class="img-fluid">
                            <p class="card-title mt-3 text-center">
                                <strong>Automate with Attune</strong>
                            </p>
                            <p class="card-text text-center">
                                Download the Attune Community Edition.
                            </p>
                            <p class="text-center">
                                <a href="https://www.servertribe.com/download-attune-registration/"
                                   class="btn btn-primary mt-3">
                                    DOWNLOAD!!!
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>

<!-- Join Discord -->

        <div class="row py-5">
            <div class="jumbotron">
              <h1 class="display-4 text-center">
                  Discuss this Project in Discord
              </h1>
              <p class="lead">

                  Join our Discord channel and connect with like-minded individuals who
                  share your passion. Engage in lively discussions, gain valuable insights,
                  and stay updated on the latest trends in our industry. Don't miss out on
                  this opportunity to network, learn, and grow together.
              </p>
              <hr class="my-4 text-center">
                <div class="col px-0">
                  <p class="text-center">
                      Click the link below and become a part of our vibrant community on
                      Discord today!
                  </p>
                  <p class="lead text-center">
                    <a class="btn btn-primary btn-lg"
                       href="https://discord.com/invite/3YpJsagqUn"
                       role="button">
                        Join NOW!!!
                    </a>
                  </p>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Project Footer -->

<footer class="footer fixed-bottom bg-white border-top box-shadow">
      <div class="container px-0">
          <div class="row">
              <div class="col px-0">
                  <a class="my-0 mr-lg-auto"
                     href="https://www.servertribe.com/"
                     target="_blank">
                      <img
                          src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                          alt="Attune - Powered by ServerTribe"
                          class="img-fluid navbar-img">
                  </a>
              </div>
          </div>
      </div>
</footer>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>


</body>
</html>
